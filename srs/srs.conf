# SRS Configuration for YouTube-style streaming platform

listen              1935;
max_connections     1000;
srs_log_tank        file;
srs_log_file        ./objs/srs.log;
daemon              off;

# HTTP API for management
http_api {
    enabled         on;
    listen          8080;
    crossdomain     on;
}

# HTTP Server for HLS and other web content
http_server {
    enabled         on;
    listen          8080;
    dir             ./objs/nginx/html;
}

# Statistics
stats {
    network         0;
    disk            sda vda xvda xvdb;
}

# RTMP configuration
vhost __defaultVhost__ {
    # Enable HLS (HTTP Live Streaming)
    hls {
        enabled         on;
        hls_fragment    10;
        hls_window      60;
        hls_path        ./objs/nginx/html;
        hls_m3u8_file   [app]/[stream].m3u8;
        hls_ts_file     [app]/[stream]-[seq].ts;
    }
    
    # Enable HTTP-FLV streaming
    http_remux {
        enabled     on;
        mount       [vhost]/[app]/[stream].flv;
    }
    
    # DVR (Digital Video Recording) for playback
    dvr {
        enabled         on;
        dvr_path        ./objs/nginx/html/[app]/[stream]/[timestamp].flv;
        dvr_plan        segment;
        dvr_duration    30;
        dvr_wait_keyframe   on;
        time_jitter     full;
    }
    
    # Security and authentication
    refer {
        enabled         on;
        all             off;
        publish         127.0.0.1 localhost;
        play            all;
    }
    
    # Transcoding
    transcode {
        enabled     on;
        ffmpeg      ./objs/ffmpeg/bin/ffmpeg;
        
        engine original {
            enabled         on;
            vfilter {
            }
            vcodec          copy;
            acodec          copy;
            output          rtmp://127.0.0.1:[port]/[app]?vhost=[vhost]/[stream]_[engine];
        }
        
        engine sd {
            enabled         on;
            vfilter {
                v               quiet;
                vf              scale=720:404;
            }
            vcodec          libx264;
            vbitrate        800;
            vfps            25;
            vwidth          720;
            vheight         404;
            vthreads        4;
            vprofile        baseline;
            vpreset         superfast;
            acodec          aac;
            abitrate        64;
            asample_rate    44100;
            achannels       2;
            output          rtmp://127.0.0.1:[port]/[app]?vhost=[vhost]/[stream]_[engine];
        }
    }
    
    # Forward streams to other servers if needed
    forward {
        enabled         off;
        destination     127.0.0.1:19350;
    }
    
    # Bandwidth testing
    bandcheck {
        enabled         on;
        key             "35c9b402c12a7246868752e2878f7e0e";
        interval        30;
        limit_kbps      4000;
    }
    
    # Security for publishing
    security {
        enabled         on;
        seo {
            enabled         on;
        }
    }
}